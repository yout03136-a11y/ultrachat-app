<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#075E54" />
  <title>UltraChat Gold</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body, #root {
      height: 100%; width: 100%;
      overflow: hidden;
      background: #111B21;
      font-family: -apple-system, 'Segoe UI', Roboto, sans-serif;
    }
    /* Respect Android safe areas */
    #root {
      padding-top: env(safe-area-inset-top, 0px);
      padding-bottom: env(safe-area-inset-bottom, 0px);
    }
    #loading {
      position: fixed; inset: 0;
      background: #075E54;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      z-index: 9999;
      transition: opacity 0.4s;
    }
    #loading svg { width: 72px; height: 72px; }
    #loading h1 { color: white; font-size: 26px; margin-top: 14px; font-weight: 700; }
    #loading p { color: rgba(255,255,255,0.65); font-size: 13px; margin-top: 6px; }
    .dots { display: flex; gap: 7px; margin-top: 36px; }
    .dot { width: 7px; height: 7px; background: rgba(255,255,255,0.5); border-radius: 50%; animation: blink 1.4s ease-in-out infinite; }
    .dot:nth-child(2) { animation-delay: .2s; }
    .dot:nth-child(3) { animation-delay: .4s; }
    @keyframes blink { 0%,80%,100%{transform:scale(.6);opacity:.5} 40%{transform:scale(1);opacity:1} }
  </style>
</head>
<body>

<div id="loading">
  <svg viewBox="0 0 80 80" fill="none">
    <circle cx="40" cy="40" r="40" fill="rgba(255,255,255,0.15)"/>
    <path d="M18 30Q18 18 30 18H50Q62 18 62 30V48Q62 60 50 60H44L36 68V60H30Q18 60 18 48Z" fill="white"/>
    <circle cx="30" cy="39" r="4" fill="#075E54"/>
    <circle cx="40" cy="39" r="4" fill="#075E54"/>
    <circle cx="50" cy="39" r="4" fill="#075E54"/>
  </svg>
  <h1>UltraChat Gold</h1>
  <p>جاري التحميل...</p>
  <div class="dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
</div>

<div id="root"></div>
<div id="recaptcha-container"></div>

<!-- React 18 via CDN -->
<script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script>
  // Native Android bridge helpers
  window.isAndroidApp = true;

  // Wrap AndroidBridge calls safely
  window.native = {
    toast: (msg) => window.AndroidBridge?.showToast(msg),
    vibrate: (ms) => window.AndroidBridge?.vibrate(ms || 50),
    share: (text, title) => window.AndroidBridge?.shareText(text, title || 'UltraChat'),
    biometric: (reason) => window.AndroidBridge?.openBiometricAuth(reason || 'تأكيد هويتك'),
    deviceInfo: () => {
      try { return JSON.parse(window.AndroidBridge?.getDeviceInfo() || '{}'); }
      catch(e) { return {}; }
    },
    permissions: (list) => window.AndroidBridge?.requestPermissions(JSON.stringify(list)),
    exit: () => window.AndroidBridge?.exitApp(),
    // Native persistent storage (faster than localStorage in WebView)
    store: {
      set: (k,v) => window.NativeStorage?.setItem(k, typeof v === 'string' ? v : JSON.stringify(v)),
      get: (k) => { try { const v = window.NativeStorage?.getItem(k); return v ? JSON.parse(v) : null; } catch(e){ return window.NativeStorage?.getItem(k); } },
      remove: (k) => window.NativeStorage?.removeItem(k),
      clear: () => window.NativeStorage?.clear(),
    }
  };

  // Hide loading screen
  function hideLoading() {
    const el = document.getElementById('loading');
    if (el) { el.style.opacity = '0'; setTimeout(() => el.remove(), 400); }
  }
  window.addEventListener('load', () => setTimeout(hideLoading, 800));
  setTimeout(hideLoading, 4000); // fallback
</script>

<!-- Load React App -->
<script type="text/babel" src="app.jsx"></script>

<script>
  // Mount after Babel compiles
  setTimeout(() => {
    if (typeof App !== 'undefined') {
      ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
      hideLoading();
    }
  }, 1200);
</script>

</body>
</html>
